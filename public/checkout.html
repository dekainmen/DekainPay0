<!DOCTYPE html>
<html>
<head>
  <title>Checkout | Dekain</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          brand: {
            bg: "#F5F1EC",
            cream: "#EFE7DE",
            brown: "#8B5E3C",
            dark: "#4A3426",
            charcoal: "#1F1F1F",
            border: "#D6CFC7"
          }
        }
      }
    }
  }
  </script>
</head>

<body class="bg-brand-bg text-brand-dark">

<!-- ================= HEADER ================= -->
<header class="bg-brand-charcoal text-white">

  <div class="
    max-w-7xl mx-auto
    flex items-center
    justify-between
    px-8 py-4
  ">

    <!-- Logo -->
    <h1 class="
      text-xl font-semibold
      tracking-wide
      cursor-pointer
    "
    onclick="window.location.href='/'">
      DEKAIN
    </h1>

    <!-- Navigation -->
    <nav class="
      hidden md:flex
      space-x-8
      text-sm font-medium
    ">

      <a href="/category.html?cat=Clothing"
        class="hover:text-gray-300">Clothing</a>

      <a href="/category.html?cat=Ethnics"
        class="hover:text-gray-300">Ethnics</a>

      <a href="/category.html?cat=Footwear"
        class="hover:text-gray-300">Footwear</a>

      <a href="/category.html?cat=Grooming"
        class="hover:text-gray-300">Grooming</a>

      <a href="/category.html?cat=Watches"
        class="hover:text-gray-300">Watches</a>

      <a href="/category.html?cat=Accessories"
        class="hover:text-gray-300">Accessories</a>

      <a href="/bulk-orders.html"
        class="hover:text-gray-300">Bulk Orders</a>

      <a href="/about.html"
        class="hover:text-gray-300">About Us</a>

    </nav>

    <!-- Cart -->
    <a href="/cart.html"
      class="
        border border-white
        px-4 py-2
        rounded-lg
        hover:bg-white
        hover:text-black
        transition
      ">
      Cart ðŸ›’
    </a>

  </div>

</header>
<!-- =============== HEADER END =============== -->


<!-- ================= PAGE ================= -->
<div class="
  max-w-7xl mx-auto
  grid md:grid-cols-2
  gap-10
  p-8
">

  <!-- ========== CUSTOMER FORM ========== -->
  <div>

    <h2 class="
      text-2xl font-light
      mb-6
    ">
      Customer Details
    </h2>

    <div class="space-y-4">

      <input id="name"
        placeholder="Full Name"
        class="
          w-full p-3
          border border-brand-border
          rounded-lg
          bg-white
        " />

      <input id="email"
        placeholder="Email"
        class="
          w-full p-3
          border border-brand-border
          rounded-lg
          bg-white
        " />

      <input id="phone"
        placeholder="Phone"
        class="
          w-full p-3
          border border-brand-border
          rounded-lg
          bg-white
        " />

      <textarea id="address"
        placeholder="Address"
        class="
          w-full p-3
          border border-brand-border
          rounded-lg
          bg-white
        ">
      </textarea>

    </div>

  </div>


  <!-- ========== ORDER SUMMARY ========== -->
  <div>

    <h2 class="
      text-2xl font-light
      mb-6
    ">
      Order Summary
    </h2>

    <div id="summary"
      class="space-y-3 mb-6">
    </div>

    <h3 id="total"
      class="
        text-xl font-semibold
        mb-6
      ">
    </h3>

    <button
      id="payBtn"
      onclick="payNow()"
      class="
        w-full
        bg-brand-brown
        text-white
        py-3
        rounded-lg
        hover:bg-brand-dark
        transition
      ">
      Pay Now
    </button>

  </div>

</div>


<script>

/**
 * Load cart
 */
const cart =
  JSON.parse(
    localStorage.getItem("cart")
  ) || [];

const container =
  document.getElementById("summary");

let total = 0;

/**
 * Empty cart check
 */
if (cart.length === 0) {

  container.innerHTML =
    "<p>Cart empty</p>";

  document.getElementById(
    "payBtn"
  ).disabled = true;

} else {

  cart.forEach(item => {

    const itemTotal =
      item.price * item.qty;

    total += itemTotal;

    container.innerHTML += `
      <div class="
        flex justify-between
        bg-brand-cream
        border border-brand-border
        p-3 rounded-lg
      ">
        <p>${item.name} Ã— ${item.qty}</p>
        <p>â‚¹${itemTotal}</p>
      </div>
    `;
  });
}

/**
 * Total render
 */
document.getElementById(
  "total"
).innerText =
  "Total: â‚¹" + total;


/**
 * Validate + Initiate Payment
 */
async function payNow() {

  const name =
    document.getElementById("name").value;

  const email =
    document.getElementById("email").value;

  const phone =
    document.getElementById("phone").value;

  if (!name || !phone) {

    alert(
      "Name & phone required"
    );

    return;
  }

  document.getElementById(
    "payBtn"
  ).innerText =
    "Processing...";

  const payload = {
    products: cart,
    customer: {
      name,
      email,
      phone
    }
  };

  const res =
    await fetch(
      "/api/payment/create",
      {
        method: "POST",
        headers: {
          "Content-Type":
            "application/json"
        },
        body:
          JSON.stringify(payload)
      }
    );

  const data =
    await res.json();

  if (data.paymentUrl) {

    window.location.href =
      data.paymentUrl;

  } else {

    alert(
      JSON.stringify(data)
    );

    document.getElementById(
      "payBtn"
    ).innerText =
      "Pay Now";
  }
}

</script>

</body>
</html>
